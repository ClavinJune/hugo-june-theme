{{ $img := resources.GetMatch (.Get "src") }}

{{- $ws := slice 240 300 360 480 768 800 960 1024 1080 1200 1366 1920 $img.Width -}}

{{- $srcset := slice -}}
{{ range $ws }}
  {{ if (le . $img.Width) }}
    {{ $w := printf "%dx webp q50" . }}
    {{ $url := printf "%s %dw" (($img.Resize $w).RelPermalink | safeURL) . }}
    {{ $srcset = $srcset | append $url }}
  {{ end }}
{{ end }}

{{ $set := delimit $srcset "," }}


{{ $alt := .Get "alt" }}
{{ $title := cond (not (.Get "title")) $alt (.Get "title") }}

<figure>
  <img
    srcset="{{ $set }}"
    sizes="(max-width: 480px) 480px, 100vw"
    src="{{ $img.RelPermalink }}" alt="{{ $alt | safeHTML }}" title="{{ $title | safeHTML }}" width="100%" height="auto"/>
  <figcaption class="font-16">{{$alt | safeHTML }}</figcaption>
</figure>